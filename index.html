<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JustStreamIt</title>
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/category.css">
    <script type="text/javascript"
            src="script/data_movie.js",
            src="script/script.js">
    </script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>

    <! -- Header -->

    <header class="main-header">
      <div class="container">
          <h1 class="logo">
              <img src="#" width="150" height="100" alt="JustStreamIT">
          </h1>
          <nav class="main-nav">
              <ul class="main-nav-list">
                  <li>
                      <p>Acceuil</p>
                  </li>
                  <li>
                      <p>Categorie</p>
                  </li>
              </ul>
          </nav>
      </div>
    </header>

    <! -- Movies categories -->

    <h2>Meilleur film</h2>
    <section class="section-video-player">
        <div class="video-container yellow">
            <button class="player-button">Play_button</button>
            <a href="#">Lien du film</a>
        </div>
        <div>
            <img id="logo-best-movie" src="#" alt="image film">
        </div>
    </section>

    <h2>Films les mieux notés</h2>
    <br>
    <section class="categorie green">
            <button class="arrow-left" id="best-movie-left">&#10094;</button>
                <ul class="carousel" id="best-movie">
                    
                </ul>
            <button class="arrow-right" id="best-movie-right">&#10095;</button>
    </section>

    <h2>Categorie 1</h2>
    <br>
    <section class="categorie green">
            <button class="arrow-left" id="cat-1-left">&#10094;</button>
                <ul class="carousel" id="categorie-1">

                </ul>
            <button class="arrow-right" id="cat-1-right">&#10095;</button>
    </section>

    <h2>Categorie 2</h2>
    <br>
    <section class="categorie green">
            <button class="arrow-left" id="cat-2-left">&#10094;</button>
                <ul class="carousel" id="categorie-2">

                </ul>
            <button class="arrow-right" id="cat-2-right">&#10095;</button>
    </section>

    <h2>Categorie 3</h2>
    <br>
    <section class="categorie green">
            <button class="arrow-left" id="cat-3-left">&#10094;</button>
                <ul class="carousel" id="categorie-3">

                </ul>
            <button class="arrow-right" id="cat-3-right">&#10095;</button>
    </section>

    <script type="module">
        let catContainer = document.querySelector("#best-movie")
        let slide = document.querySelector("#slide")
        let catContainer3 = document.querySelector("#categorie-3")
        let catContainer2 = document.querySelector("#categorie-2")
        let catContainer1 = document.querySelector("#categorie-1")
        let leftButton3 = document.querySelector("#cat-3-left")
        let rightButton3 = document.querySelector("#cat-3-right")
        let leftButton2 = document.querySelector("#cat-2-left")
        let rightButton2 = document.querySelector("#cat-2-right")
        let leftButton1 = document.querySelector("#cat-1-left")
        let rightButton1 = document.querySelector("#cat-1-right")
        let bestLeftButton = document.querySelector("#best-movie-left")
        let bestRightButton = document.querySelector("#best-movie-right")

        let idMin = 0
        let idMax = 4
        const slider = ["1.jpeg", "2.jpeg", "3.jpeg", "4.jpeg"]
        let data = Data



        async function getCategoriesMovies(countMovies, genre){
            let number = countMovies
            let resultsData = []
            let url = "http://localhost:8000/api/v1/titles/?genre=" + genre
            let authorize = true 
            do{
                let response = await fetch(url)
                let data = await response.json()
                url = data.next
                for (let dataMovie of data.results){
                    if(resultsData.length >= number){
                        authorize = false
                        break;
                    }
                    resultsData.push(dataMovie)
                }
            }while(authorize)
            return resultsData
        }
        
        // test appel fonction async pour données brutes des catégories
        async function getImdbScore(countMovie, maxImdbScore){
            let number = countMovie
            let url = "http://localhost:8000/api/v1/titles/?" + new URLSearchParams({imdb_score_min:maxImdbScore})
            let bestResults = []
            let authorize = true
            do{
                let response = await fetch(url)
                let bestData = await response.json()
                url = bestData.next
                for (let bestMovie of bestData.results){
                    bestResults.push(bestMovie)
                    if(bestResults.length >= number){
                        authorize = false
                        break;
                    }
                }
            }while(authorize)
            bestResults.sort(function(a,b){return a.imdb_score - b.imdb_score})
            return bestResults
        }
        //await getImdbScore(4, 9.4)

        //await getCategoriesMovies(4, "Action")
        //await getCategoriesMovies(4, "Animation")
        //await getCategoriesMovies(4, "Crime")

        // récupération des score imdb par films
        
        async function displayBestMovie(){
            catContainer.innerHTML = ""
            const bestMovies = await getImdbScore(4, 9.4)
            for (let bestCat of bestMovies){
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = bestCat.image_url
                catContainer.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            }
        }
        await displayBestMovie()
        

        async function displayActionMovie(){
            catContainer1.innerHTML = ""
            const actionMovies = await getCategoriesMovies(4, "Action")
            for (let actionCat of actionMovies){
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = actionCat.image_url
                catContainer1.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            }
        }
        await displayActionMovie()

        async function displayAnimationMovie(){
            const animationMovies = await getCategoriesMovies(4, "Animation")
            catContainer2.innerHTML = ""
            for (let animationCat of animationMovies){
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = animationCat.image_url
                catContainer2.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            }
        }
        await displayAnimationMovie()

        async function displayCrimeMovie(){
            catContainer3.innerHTML = ""
            const crimeMovies = await getCategoriesMovies(4, "Crime")
            for (let crimeCat of crimeMovies){
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = crimeCat.image_url
                catContainer3.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            }
        }
        await displayCrimeMovie()

        //Slider Categorie Meilleur Film
        bestLeftButton.addEventListener("click", async function(){
            if(idMin < 1){
                return
                };
            idMin -= 1
            idMax -= 1
            for (let i = idMin; i < idMax; i++) {
                await displayBestMovie()
            };
        });

        bestRightButton.addEventListener("click", async function(){
            if(idMin < 1){
                return
                };
            idMin += 1
            idMax += 1
            for (let i = idMin; i < idMax; i++) {
                await displayBestMovie()
            };
        });

        //Slider Categorie Crime
        leftButton3.addEventListener("click", async function(){
            if(idMin < 1){
                return
                };
            idMin -= 1
            idMax -= 1
            for (let i = idMin; i < idMax; i++) {
                await displayCrimeMovie()
            };
        });

        rightButton3.addEventListener("click", async function(){
            if(idMax > 7){
                return
                };
            idMin += 1
            idMax += 1
            for (let i = idMin; i < idMax; i++) {
                await displayCrimeMovie()
            };
        });

        //Slider Categorie Animation
        leftButton2.addEventListener("click", async function(){
            if(idMin < 1){
                return
                };
            idMin -= 1
            idMax -= 1
            for (let i = idMin; i < idMax; i++) {
                await displayAnimationMovie()
            };
        });


        rightButton2.addEventListener("click", async function(){
            if(idMax > 7){
                return
                };
            idMin += 1
            idMax += 1
            for (let i = idMin; i < idMax; i++) {
                await displayAnimationMovie()
            };
        });

        //Slider Categorie Action
        leftButton1.addEventListener("click", async function(){
            if(idMin < 1){
                return
                };
            idMin -= 1
            idMax -= 1
            for (let i = idMin; i < idMax; i++) {
                await displayActionMovie()
            };
        });


        rightButton1.addEventListener("click", async function(){
            if(idMax > 7){
                return
                };
            idMin += 1
            idMax += 1
            for (let i = idMin; i < idMax; i++) {
                await displayActionMovie()
            };

        });
    </script>

</body>
</html>