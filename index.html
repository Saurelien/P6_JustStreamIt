<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JustStreamIt</title>
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/category.css">
    <link rel="stylesheet" href="css/modal.css">
    <script type="text/javascript"
            src="script/data_movie.js",
            src="script/script.js">
    </script>
</head>
<body>

    <! -- Header -->

    <header class="main-header">
      <div class="container">
          <h1 class="logo">
              <img src="#" width="150" height="100" alt="JustStreamIT">
          </h1>
          <nav class="main-nav">
              <ul class="main-nav-list">
                  <li>
                      <p>Acceuil</p>
                  </li>
                  <li>
                      <p>Categorie</p>
                  </li>
              </ul>
          </nav>
      </div>
    </header>

    <!-- Trigger/Open The Modal -->
    <button id="myBtn">Open Modal</button>

    <!-- The Modal -->
    <div id="myModal" class="modal">

        <!-- Modal content -->
        <div class="modal-content" id="modal-content">
            <div class="modal-header">
            <span class="close">&times;</span>
            <h2>Modal Header</h2>
            </div>
            <div class="modal-body" id="modalContent">
            <p>Some text in the Modal Body</p>
            <p>Some other text...</p>
            </div>
            <div class="modal-footer">
            <h3>Modal Footer</h3>
            </div>
        </div>

    </div>

    <! -- Movies categories -->

    <h2>Meilleur film</h2>
    <section class="section-video-player">
        <div class="video-container yellow">
            <button class="player-button">Play_button</button>
            <a href="#">Lien du film</a>
        </div>
        <div>
            <img id="logo-best-movie" src="#" alt="image film">
        </div>
    </section>

    <h2>Films les mieux notés</h2>
    <br>
    <section class="categorie green">
            <button class="arrow-left" id="best-movie-left">&#10094;</button>
                <ul class="carousel" id="best-movie">
                    
                </ul>
            <button class="arrow-right" id="best-movie-right">&#10095;</button>
    </section>

    <h2>Categorie Action</h2>
    <br>
    <section class="categorie green">
            <button class="arrow-left" id="cat-1-left">&#10094;</button>
                <ul class="carousel" id="categorie-1">

                </ul>
            <button class="arrow-right" id="cat-1-right">&#10095;</button>
    </section>

    <h2>Categorie Animation</h2>
    <br>
    <section class="categorie green">
            <button class="arrow-left" id="cat-2-left">&#10094;</button>
                <ul class="carousel" id="categorie-2">

                </ul>
            <button class="arrow-right" id="cat-2-right">&#10095;</button>
    </section>

    <h2>Categorie Crime</h2>
    <br>
    <section class="categorie green">
            <button class="arrow-left" id="cat-3-left">&#10094;</button>
                <ul class="carousel" id="categorie-3">

                </ul>
            <button class="arrow-right" id="cat-3-right">&#10095;</button>
    </section>

    <script type="module">
        const catContainer = document.querySelector("#best-movie")
        const catContainer3 = document.querySelector("#categorie-3")
        const catContainer2 = document.querySelector("#categorie-2")
        const catContainer1 = document.querySelector("#categorie-1")
        const leftButton3 = document.querySelector("#cat-3-left")
        const rightButton3 = document.querySelector("#cat-3-right")
        const leftButton2 = document.querySelector("#cat-2-left")
        const rightButton2 = document.querySelector("#cat-2-right")
        const leftButton1 = document.querySelector("#cat-1-left")
        const rightButton1 = document.querySelector("#cat-1-right")
        const bestLeftButton = document.querySelector("#best-movie-left")
        const bestRightButton = document.querySelector("#best-movie-right")

        let bestMinId = 0
        let bestMaxId = 4
        let actionMinId = 0
        let actionMaxID = 4
        let animationMinId = 0
        let animationMaxID = 4
        let crimeMinID = 0
        let crimeMaxID = 4

        let bestMovies = await getImdbScore(7, "9.3")
        let actionMovies = await getCategoriesMovies(7, "Action")
        let animationMovies = await getCategoriesMovies(7, "Animation")
        let crimeMovies = await getCategoriesMovies(7, "Crime")

        const bestButton = document.getElementById("myBtn")
        const modal = document.querySelector("#myModal")
        const closeModal = document.querySelector(".close")
        
        async function detailMovies(id){
            let detail = []
            let url = "http://localhost:8000/api/v1/titles/" + id
            console.log(url)
            let response = await fetch(url)
            let dataDetail = await response.json()
            detail.push(dataDetail)
            /*for(let data of dataDetail.restults){
                console.log(data)
                detail.push(data)
            }*/
            console.log(detail)
            return detail
        }
        await detailMovies(1508669)
        
        bestButton.onclick = async function(){
            let details = await detailMovies(1508669)
            for(let info of details){
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                let elementLiActors = document.createElement("li")
                let movieTitle = document.createElement("h1")
                let movieWriter = document.createElement("h2")
                let movieDirectors = document.createElement("h3")
                let movieActors = document.createElement("h4")
                imageAnchor.src = info.image_url
                console.log(imageAnchor)
                movieTitle.innerHTML = info.title
                movieWriter.innerHTML = info.writer
                movieDirectors.innerHTML = info.directors
                movieActors.innerHTML = info.actors
                console.log(movieActors)
                console.log(imageAnchor.src)
                modal.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
                elementLi.appendChild(elementLiActors)
                elementLi.appendChild(movieTitle)
                elementLiActors.appendChild(movieWriter)
                elementLiActors.appendChild(movieDirectors)
                elementLiActors.appendChild(movieActors)
            }
            modal.style.display = "block"
        }
        /*
        bestButton.onclick = function(){
            modal.style.display = "block"
        }
        */
        closeModal.onclick = function(){
            modal.style.display = "none";
        }
        window.onclick = function(close){
            if(close.target == modal){
                modal.style.display = "none"
            }
        }

        //fonction async pour données brutes des catégories
        async function getCategoriesMovies(countMovies, genre){
            let number = countMovies
            let resultsData = []
            let url = "http://localhost:8000/api/v1/titles/?sort_by=-imdb_score&genre=" + genre 
            let authorize = true 
            do{
                let response = await fetch(url)
                let data = await response.json()
                url = data.next
                for (let dataMovie of data.results){
                    resultsData.imdb_score >= "9.3"
                    if(resultsData.length >= number){
                        authorize = false
                        break;
                    }
                    resultsData.push(dataMovie)
                }
            }while(authorize)
            return resultsData
        }
        
        //fonction async pour données brutes des meilleurs films
        async function getImdbScore(countMovie, maxImdbScore){
            let number = countMovie
            let url = "http://localhost:8000/api/v1/titles/?sort_by=-imdb_score"
            let bestResults = []
            let authorize = true
            do{
                let response = await fetch(url)
                let bestData = await response.json()
                url = bestData.next
                for (let bestMovie of bestData.results){
                    if(bestResults.length >= number){
                        authorize = false
                        break;
                    }
                    bestResults.push(bestMovie)
                }
            }while(authorize)
            return bestResults
        }


        async function displayBestMovie(){
            const bestMovies = await getImdbScore(4, "9.3")
            console.log(bestMovies)
            for (let bestCat of bestMovies){
                //const btn = document.createElement("button")
                //btn.setAttribute("id", "bestBtn")
                //console.log(btn)
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = bestCat.image_url
                catContainer.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            }
        }
        await displayBestMovie()

        async function displayActionMovie(){
            const actionMovies = await getCategoriesMovies(4, "Action")
            console.log(actionMovies)
            for (let actionCat of actionMovies){
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = actionCat.image_url
                catContainer1.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            }
        }
        await displayActionMovie()

        async function displayAnimationMovie(){
            const animationMovies = await getCategoriesMovies(4, "Animation")
            for (let animationCat of animationMovies){
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = animationCat.image_url
                catContainer2.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            }
        }
        await displayAnimationMovie()

        async function displayCrimeMovie(){
            const crimeMovies = await getCategoriesMovies(4, "Crime")
            for (let crimeCat of crimeMovies){
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = crimeCat.image_url
                catContainer3.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            }
        }
        await displayCrimeMovie()
        

        //Slider Categorie Meilleur Film
        bestLeftButton.addEventListener("click", async function(){
            console.log("actionMinId :", bestMinId + "\n actionMaxID :", bestMaxId)
            if(bestMinId === 0 && bestMaxId === 4){
                return
                };
            bestMinId -= 1
            bestMaxId -= 1
            catContainer.innerHTML = ""
            console.log(bestMovies)
            for (let i = bestMinId; i < bestMaxId; i++) {
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                console.log(bestMovies[i])
                imageAnchor.src = bestMovies[i].image_url
                catContainer.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            };
        });

        bestRightButton.addEventListener("click", async function(){
            console.log("actionMinId :", bestMinId + "\n actionMaxID :", bestMaxId)
            if(bestMinId === 3 && bestMaxId === 7){
                return
                };
            bestMinId += 1
            bestMaxId += 1
            catContainer.innerHTML = ""
            for (let i = bestMinId; i < bestMaxId; i++) {
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                console.log(bestMovies[i])
                imageAnchor.src = bestMovies[i].image_url
                catContainer.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            };
        });

        //Slider Categorie Action
        leftButton1.addEventListener("click", async function(){
            console.log("actionMinId :", actionMinId + "\n actionMaxID :", actionMaxID)
            if(actionMinId === 0 && actionMaxID === 4){
                return
                };
            actionMinId -= 1
            actionMaxID -= 1
            catContainer1.innerHTML = ""
            for (let i = actionMinId; i < actionMaxID; i++) {
                console.log(i)
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = actionMovies[i].image_url
                catContainer1.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            };
        });


        rightButton1.addEventListener("click", async function(){
            console.log("actionMinId :", actionMinId + "\n actionMaxID :"+ actionMaxID)
            if(actionMinId === 3 && actionMaxID === 7){
                return
                };
            actionMinId += 1
            actionMaxID += 1
            catContainer1.innerHTML = ""
            for (let i = actionMinId; i < actionMaxID; i++) {
                console.log(i)
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = actionMovies[i].image_url
                catContainer1.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            };

        });


        //Slider Categorie Crime
        leftButton3.addEventListener("click", async function(){
            if(animationMinId === 0 && animationMaxID === 4){
                return
                };
            animationMinId -= 1
            animationMaxID -= 1
            catContainer3.innerHTML = ""
            for (let i = animationMinId; i < animationMaxID; i++) {
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = crimeMovies[i].image_url
                catContainer3.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            };
        });

        rightButton3.addEventListener("click", async function(){
            if(animationMinId === 3 && animationMaxID === 7){
                return
                };
            animationMinId += 1
            animationMaxID += 1
            catContainer3.innerHTML = ""
            for (let i = animationMinId; i < animationMaxID; i++) {
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = crimeMovies[i].image_url
                catContainer3.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            };
        });

        //Slider Categorie Animation
        leftButton2.addEventListener("click", async function(){
            if(crimeMinID === 0 && crimeMaxID === 4){
                return
                };
            crimeMinID -= 1
            crimeMaxID -= 1
            catContainer2.innerHTML = ""
            for (let i = crimeMinID; i < crimeMaxID; i++) {
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = animationMovies[i].image_url
                catContainer2.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            };
        });


        rightButton2.addEventListener("click", async function(){
            if(crimeMinID === 3 && crimeMaxID === 7){
                return
                };
            crimeMinID += 1
            crimeMaxID += 1
            catContainer2.innerHTML = ""
            for (let i = crimeMinID; i < crimeMaxID; i++) {
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = animationMovies[i].image_url
                catContainer2.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            };
        });
    </script>

</body>
</html>