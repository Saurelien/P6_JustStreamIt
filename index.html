<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JustStreamIt</title>
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/category.css">
    <link rel=""stylesheet href="css/modal.css">
    <script type="text/javascript"
            src="script/data_movie.js",
            src="script/script.js">
    </script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>

    <! -- Header -->

    <header class="main-header">
      <div class="container">
          <h1 class="logo">
              <img src="#" width="150" height="100" alt="JustStreamIT">
          </h1>
          <nav class="main-nav">
              <ul class="main-nav-list">
                  <li>
                      <p>Acceuil</p>
                  </li>
                  <li>
                      <p>Categorie</p>
                  </li>
              </ul>
          </nav>
      </div>
    </header>

    <!-- La modal -->
    <div id="myModal" class="modal">
        <!--Contenu de la modal-->
        <div class=""modal-content>
            <span class="closeModal"></span>
        </div>
    </div>

    <! -- Movies categories -->

    <h2>Meilleur film</h2>
    <section class="section-video-player">
        <div class="video-container yellow">
            <button class="player-button">Play_button</button>
            <a href="#">Lien du film</a>
        </div>
        <div>
            <img id="logo-best-movie" src="#" alt="image film">
        </div>
    </section>

    <h2>Films les mieux notés</h2>
    <br>
    <section class="categorie green">
            <button class="arrow-left" id="best-movie-left">&#10094;</button>
                <ul class="carousel" id="best-movie">
                    
                </ul>
            <button class="arrow-right" id="best-movie-right">&#10095;</button>
    </section>

    <h2>Categorie 1</h2>
    <br>
    <section class="categorie green">
            <button class="arrow-left" id="cat-1-left">&#10094;</button>
                <ul class="carousel" id="categorie-1">

                </ul>
            <button class="arrow-right" id="cat-1-right">&#10095;</button>
    </section>

    <h2>Categorie 2</h2>
    <br>
    <section class="categorie green">
            <button class="arrow-left" id="cat-2-left">&#10094;</button>
                <ul class="carousel" id="categorie-2">

                </ul>
            <button class="arrow-right" id="cat-2-right">&#10095;</button>
    </section>

    <h2>Categorie 3</h2>
    <br>
    <section class="categorie green">
            <button class="arrow-left" id="cat-3-left">&#10094;</button>
                <ul class="carousel" id="categorie-3">

                </ul>
            <button class="arrow-right" id="cat-3-right">&#10095;</button>
    </section>

    <script type="module">
        const catContainer = document.querySelector("#best-movie")
        const slide = document.querySelector("#slide")
        const catContainer3 = document.querySelector("#categorie-3")
        const catContainer2 = document.querySelector("#categorie-2")
        const catContainer1 = document.querySelector("#categorie-1")
        const leftButton3 = document.querySelector("#cat-3-left")
        const rightButton3 = document.querySelector("#cat-3-right")
        const leftButton2 = document.querySelector("#cat-2-left")
        const rightButton2 = document.querySelector("#cat-2-right")
        const leftButton1 = document.querySelector("#cat-1-left")
        const rightButton1 = document.querySelector("#cat-1-right")
        const bestLeftButton = document.querySelector("#best-movie-left")
        const bestRightButton = document.querySelector("#best-movie-right")
        const modal = document.querySelector("#myModal")
        const closeModal = document.getElementsByClassName("closeModal")

        // Section Modal

        modal.addEventListener("click", async function(){
            model.style.display = "block"
        });

        let idMin = 0
        let idMax = 4
        let bestMinId = 0
        let bestMaxId = 4
        let actionMinId = 0
        let actionMaxID = 4
        let animationMinId = 0
        let animationMaxID = 4
        let crimeMinID = 0
        let crimeMaxID = 4

        //fonction async pour données brutes des catégories
        async function getCategoriesMovies(countMovies, genre){
            let number = countMovies
            let resultsData = []
            let url = "http://localhost:8000/api/v1/titles/?genre=" + genre
            let authorize = true 
            do{
                let response = await fetch(url)
                let data = await response.json()
                url = data.next
                for (let dataMovie of data.results){
                    resultsData.push(dataMovie)
                    if(resultsData.length >= number){
                        authorize = false
                        break;
                    }
                }
            }while(authorize)
            return resultsData
        }
        
        //fonction async pour données brutes des meilleurs films
        async function getImdbScore(countMovie, maxImdbScore){
            let number = countMovie
            let url = "http://localhost:8000/api/v1/titles/?" + new URLSearchParams({imdb_score_min:maxImdbScore})
            let bestResults = []
            let authorize = true
            do{
                let response = await fetch(url)
                let bestData = await response.json()
                url = bestData.next
                for (let bestMovie of bestData.results){
                    if(bestResults.length >= number){
                        authorize = false
                        break;
                    }
                    bestResults.push(bestMovie)
                }
            }while(authorize)
            bestResults.sort(function(a,b){return b.imdb_score - a.imdb_score})
            return bestResults
        }

        async function modalMovie(container, display){
            //trigger ouverture modal
            const modalOpen = document.createElement("button")
            modalOpen.setAttribute("id","myBtn")
            console.log(modalOpen)
            // Le block html modal
            const modal = document.createElement("div")
            modal.height = "100px"
            modal.width = "100px"
            modal.setAttribute("id","myModal","class","modal")
            const modalContent = document.createElement("div")
            modalContent.setAttribute("class","modal-content")
            const closeModal = document.createElement("span")
            const modalText = document.createElement("p")
            modalText.innerText = "TOTO DID SOME TEXT TEST"
            closeModal.setAttribute("class","close")
            modalContent.appendChild(closeModal && modalText)
            modal.appendChild(modalContent)
            console.log(modal)
            //container.addEventListener("click", async function(){
                //const test = await display()
                //for (let i of test){
                    //const dataInfo = test[i].info du results...
                //}
            //})
        }
        await modalMovie()

        async function displayBestMovie(){
            const bestMovies = await getImdbScore(4, "9.3")
            console.log(bestMovies)
            for (let bestCat of bestMovies){
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = bestCat.image_url
                catContainer.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            }
        }
        await displayBestMovie()

        async function displayActionMovie(){
            const actionMovies = await getCategoriesMovies(4, "Action")
            for (let actionCat of actionMovies){
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = actionCat.image_url
                catContainer1.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            }
        }
        await displayActionMovie()

        async function displayAnimationMovie(){
            const animationMovies = await getCategoriesMovies(4, "Animation")
            for (let animationCat of animationMovies){
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = animationCat.image_url
                catContainer2.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            }
        }
        await displayAnimationMovie()

        async function displayCrimeMovie(){
            const crimeMovies = await getCategoriesMovies(4, "Crime")
            for (let crimeCat of crimeMovies){
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = crimeCat.image_url
                catContainer3.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            }
        }
        await displayCrimeMovie()
        

        const bestMovies = await getImdbScore(7, "9.3")
        const actionMovies = await getCategoriesMovies(7, "Action")
        const animationMovies = await getCategoriesMovies(7, "Animation")
        const crimeMovies = await getCategoriesMovies(7, "Crime")

        
        console.log(bestMovies)
        console.log(actionMovies)
        //Slider Categorie Meilleur Film
        bestLeftButton.addEventListener("click", async function(){
            console.log(bestMinId ,"\n", bestMaxId)
            if(bestMinId === 0 && bestMaxId === 4){
                return
                };
            bestMinId -= 1
            bestMaxId -= 1
            catContainer.innerHTML = ""
            console.log(bestMovies)
            for (let i = bestMinId; i < bestMaxId; i++) {
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                console.log(bestMovies[i])
                imageAnchor.src = bestMovies[i].image_url
                catContainer.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            };
        });

        bestRightButton.addEventListener("click", async function(){
            console.log(bestMinId ,"\n", bestMaxId)
            if(bestMinId === 3 && bestMaxId === 7){
                return
                };
            bestMinId += 1
            bestMaxId += 1
            catContainer.innerHTML = ""
            for (let i = bestMinId; i < bestMaxId; i++) {
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                console.log(bestMovies[i])
                imageAnchor.src = bestMovies[i].image_url
                catContainer.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            };
        });

        //Slider Categorie Action
        leftButton1.addEventListener("click", async function(){
            console.log("actionMinId :", actionMinId, "\n actionMaxID :", actionMaxID)
            if(actionMinId === 0 && actionMaxID === 4){
                return
                };
            actionMinId -= 1
            actionMaxID -= 1
            catContainer1.innerHTML = ""
            for (let i = actionMinId; i < actionMaxID; i++) {
                console.log(i)
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = actionMovies[i].image_url
                catContainer1.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            };
        });


        rightButton1.addEventListener("click", async function(){
            console.log("actionMinId :", actionMinId, "\n actionMaxID :", actionMaxID)
            if(actionMaxID === 7 && actionMinId === 3){
                return
                };
            actionMinId += 1
            actionMaxID += 1
            catContainer1.innerHTML = ""
            for (let i = actionMinId; i < actionMaxID; i++) {
                console.log(i)
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = actionMovies[i].image_url
                catContainer1.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            };

        });

        //Slider Categorie Crime
        leftButton3.addEventListener("click", async function(){
            idMin -= 1
            idMax -= 1
            if(idMin < 1){
                return
                };
            catContainer3.innerHTML = ""
            for (let i = idMin; i < idMax; i++) {
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = crimeMovies[i].image_url
                catContainer3.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            };
        });

        rightButton3.addEventListener("click", async function(){
            if(idMax > 7){
                return
                };
            idMin += 1
            idMax += 1
            catContainer3.innerHTML = ""
            for (let i = idMin; i < idMax; i++) {
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = crimeMovies[i].image_url
                catContainer3.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            };
        });

        //Slider Categorie Animation
        leftButton2.addEventListener("click", async function(){
            if(idMin < 1){
                return
                };
            idMin -= 1
            idMax -= 1
            catContainer2.innerHTML = ""
            for (let i = idMin; i < idMax; i++) {
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = animationMovies[i].image_url
                catContainer2.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            };
        });


        rightButton2.addEventListener("click", async function(){
            if(idMax > 7){
                return
                };
            idMin += 1
            idMax += 1
            catContainer2.innerHTML = ""
            for (let i = idMin; i < idMax; i++) {
                let elementLi = document.createElement("li")
                let imageAnchor = document.createElement("img")
                imageAnchor.src = animationMovies[i].image_url
                catContainer2.appendChild(elementLi)
                elementLi.appendChild(imageAnchor)
            };
        });
    </script>

</body>
</html>